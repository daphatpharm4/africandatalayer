import{c as g,r as i,j as e,M as K,p as F,g as W,q as Y,u as J}from"./index-ChD7mxZL.js";import{A as Z}from"./arrow-left-py2fwaZo.js";import{A as O,G as Q}from"./gift-CVCUPyBj.js";import{T as ee,a as te}from"./triangle-alert-C6o5YfOt.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=[["path",{d:"M3.85 8.62a4 4 0 0 1 4.78-4.77 4 4 0 0 1 6.74 0 4 4 0 0 1 4.78 4.78 4 4 0 0 1 0 6.74 4 4 0 0 1-4.77 4.78 4 4 0 0 1-6.75 0 4 4 0 0 1-4.78-4.77 4 4 0 0 1 0-6.76Z",key:"3c2336"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],I=g("BadgeCheck",se);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],_=g("Calendar",ae);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],ie=g("Settings",re);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=[["path",{d:"M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1",key:"18etb6"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4",key:"xoc0q4"}]],oe=g("Wallet",ne),he=({onBack:q,onSettings:B,onRedeem:X,language:p})=>{var f,$;const t=(s,r)=>p==="fr"?r:s,[a,S]=i.useState(null),[j,k]=i.useState(!0),[E,P]=i.useState(""),[G,x]=i.useState(t("Location not set","Position non definie")),[A,h]=i.useState([]),[u,N]=i.useState([]),[w,L]=i.useState(!0),[b,C]=i.useState(!1),[z,M]=i.useState(""),H=((s,r)=>r?"global":s==="cameroon"||s==="global"?s:"bonamoussadi")(a==null?void 0:a.mapScope,!!(a!=null&&a.isAdmin))!=="bonamoussadi",D=s=>{const r=new Date(s);if(Number.isNaN(r.getTime()))return t("Unknown","Inconnu");const o=new Date,m=o.toDateString()===r.toDateString(),c=new Date(o);c.setDate(o.getDate()-1);const d=c.toDateString()===r.toDateString(),n=r.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});return m?p==="fr"?`Aujourd'hui • ${n}`:`Today • ${n}`:d?p==="fr"?`Hier • ${n}`:`Yesterday • ${n}`:`${r.toLocaleDateString([],{month:"short",day:"2-digit"})} • ${n}`},U=s=>{const r=s.details??{},m=(typeof r.siteName=="string"?r.siteName:typeof r.name=="string"?r.name:null)||`GPS: ${s.location.latitude.toFixed(4)}°, ${s.location.longitude.toFixed(4)}°`,c=s.category==="fuel_station"?t("Fuel Station","Station-service"):s.category==="pharmacy"?t("Pharmacy","Pharmacie"):t("Mobile Money Kiosk","Kiosque mobile money"),d=r.xpAwarded,n=typeof d=="number"&&Number.isFinite(d)?d:5;return{id:s.id,date:D(s.createdAt),location:m,type:c,xp:n}},V=s=>s==="fuel_station"?t("Fuel Station","Station-service"):s==="pharmacy"?t("Pharmacy","Pharmacie"):t("Mobile Money Kiosk","Kiosque mobile money");i.useEffect(()=>{(async()=>{var r,o;try{k(!0),P("");const m=await F("/api/user");S(m);try{const[c,d]=await Promise.all([W(),F("/api/submissions?view=events")]),n=(o=(r=c==null?void 0:c.user)==null?void 0:r.id)==null?void 0:o.toLowerCase().trim();if(!n){h([]),x(t("Location not set","Position non definie"));return}const T=d.filter(l=>(typeof l.userId=="string"?l.userId.toLowerCase().trim():"")===n).sort((l,v)=>new Date(v.createdAt).getTime()-new Date(l.createdAt).getTime());h(T.map(U));const y=T[0];if(y){const l=y.details??{},v=typeof l.siteName=="string"?l.siteName:typeof l.name=="string"?l.name:null;x(v||`GPS ${y.location.latitude.toFixed(4)}°, ${y.location.longitude.toFixed(4)}°`)}else x(t("No contributions yet","Pas encore de contributions"))}catch{h([]),x(t("Location not set","Position non definie"))}}catch{S(null),P(t("Unable to load profile.","Impossible de charger le profil.")),h([]),x(t("Location not set","Position non definie"))}finally{k(!1)}})()},[p]),i.useEffect(()=>{let s=!1;return(async()=>{try{L(!0);const o=await Y();s||N(o)}catch{s||N([])}finally{s||L(!1)}})(),()=>{s=!0}},[]);const R=async()=>{if(!b){M("");try{C(!0),await J(),N([])}catch{M(t("Unable to clear sync errors.","Impossible d'effacer les erreurs de synchronisation."))}finally{C(!1)}}};return e.jsxs("div",{className:"flex flex-col h-full bg-[#f9fafb] overflow-y-auto no-scrollbar",children:[e.jsxs("div",{className:"sticky top-0 z-30 bg-white border-b border-gray-100 px-4 h-14 flex items-center justify-between",children:[e.jsx("button",{onClick:q,className:"p-2 -ml-2 text-gray-700 hover:text-[#0f2b46] transition-colors",children:e.jsx(Z,{size:20})}),e.jsx("h3",{className:"text-sm font-bold mx-auto",children:t("Dashboard","Tableau de bord")}),e.jsx("button",{onClick:B,className:"p-2 text-[#0f2b46] absolute right-2",children:e.jsx(ie,{size:20})})]}),e.jsxs("div",{className:"p-4 space-y-6",children:[e.jsxs("div",{className:"flex flex-col items-center py-4 text-center",children:[e.jsxs("div",{className:"relative mb-4",children:[e.jsx("div",{className:"w-24 h-24 rounded-full border-4 border-white shadow-xl bg-[#e7eef4] overflow-hidden",children:e.jsx("img",{src:"https://picsum.photos/seed/jeanpaul/300/300",alt:t("avatar","avatar"),className:"w-full h-full object-cover"})}),e.jsx("div",{className:"absolute -bottom-1 -right-1 p-1 bg-[#4c7c59] rounded-full border-2 border-white",children:e.jsx(I,{size:14,className:"text-white"})})]}),e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:j?e.jsx("span",{className:"inline-block h-4 w-40 rounded-full bg-gray-200 animate-pulse"}):(a==null?void 0:a.name)||(a==null?void 0:a.phone)||(a==null?void 0:a.email)||t("Contributor","Contributeur")}),!j&&e.jsxs("div",{className:"flex items-center justify-center text-[10px] text-gray-400 mt-1 font-bold uppercase tracking-widest space-x-2",children:[e.jsx(K,{size:12}),e.jsx("span",{children:G})]}),E&&e.jsx("div",{className:"mt-2 text-[10px] font-bold uppercase tracking-widest text-red-500",children:E}),e.jsx("div",{className:"mt-4",children:e.jsx("span",{className:"px-4 py-1.5 bg-[#e7eef4] text-[#0f2b46] text-[10px] font-bold rounded-full uppercase tracking-widest border border-[#d5e1eb] shadow-sm",children:t("Senior Contributor","Contributeur senior")})})]}),e.jsxs("div",{className:"bg-[#0f2b46] rounded-2xl p-6 text-white shadow-xl flex items-center justify-between relative overflow-hidden",children:[e.jsxs("div",{className:"relative z-10 space-y-1",children:[e.jsx("span",{className:"text-[10px] font-bold uppercase tracking-widest opacity-80",children:t("XP Balance","Solde XP")}),e.jsx("div",{className:"flex items-baseline space-x-1",children:j?e.jsx("div",{className:"h-8 w-24 rounded-lg bg-white/20 animate-pulse"}):e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"text-3xl font-extrabold tracking-tight",children:(($=(f=a==null?void 0:a.XP)==null?void 0:f.toLocaleString)==null?void 0:$.call(f))??"0"}),e.jsx("span",{className:"text-lg font-bold opacity-60",children:"XP"})]})})]}),e.jsx("div",{className:"relative z-10",children:e.jsx("div",{className:"w-12 h-12 bg-white/20 rounded-2xl flex items-center justify-center backdrop-blur-sm border border-white/30",children:e.jsx(O,{size:24})})})]}),(a==null?void 0:a.isAdmin)&&e.jsxs("div",{className:"bg-white p-5 rounded-2xl border border-gray-100 shadow-sm space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[10px] font-bold uppercase tracking-widest text-gray-400",children:t("Admin Map Access","Acces carte admin")}),e.jsx("span",{className:"text-sm font-bold text-gray-900",children:t("Unlock worldwide map","Debloquer la carte mondiale")})]}),e.jsx("span",{className:"inline-flex items-center rounded-full bg-[#eaf3ee] px-3 py-1 text-[10px] font-bold uppercase tracking-widest text-[#4c7c59]",children:t("Enabled","Active")})]}),e.jsx("p",{className:"text-xs text-gray-500",children:H?t("Explorer map is unlocked worldwide.","La carte Explorer est debloquee dans le monde entier."):t("Explorer map is locked to Bonamoussadi.","La carte Explorer est limitee a Bonamoussadi.")})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("button",{onClick:X,className:"h-14 bg-white text-[#0f2b46] border border-[#d5e1eb] rounded-xl text-[10px] font-bold uppercase tracking-widest shadow-sm hover:bg-[#f2f4f7] transition-all flex items-center justify-center space-x-2",children:[e.jsx(Q,{size:16}),e.jsx("span",{children:t("Redeem XP","Echanger XP")})]}),e.jsxs("button",{className:"h-14 bg-[#c86b4a] text-white rounded-xl text-[10px] font-bold uppercase tracking-widest shadow-lg hover:bg-[#b85f3f] transition-all flex items-center justify-center space-x-2",children:[e.jsx(oe,{size:16}),e.jsx("span",{children:t("Convert to Rewards","Convertir en recompenses")})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-white p-5 rounded-2xl border border-gray-100 shadow-sm space-y-3",children:[e.jsxs("div",{className:"flex items-center space-x-2 text-[#4c7c59]",children:[e.jsx(I,{size:16}),e.jsx("span",{className:"text-[10px] font-bold uppercase tracking-widest",children:t("Trust Score","Score de confiance")})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-2xl font-bold text-gray-900",children:"98%"}),e.jsx("div",{className:"mt-2 h-1 w-full bg-gray-50 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-[#4c7c59] rounded-full transition-all duration-1000",style:{width:"98%"}})})]})]}),e.jsxs("div",{className:"bg-white p-5 rounded-2xl border border-gray-100 shadow-sm space-y-3",children:[e.jsxs("div",{className:"flex items-center space-x-2 text-[#0f2b46]",children:[e.jsx(_,{size:16}),e.jsx("span",{className:"text-[10px] font-bold uppercase tracking-widest",children:t("Badges","Badges")})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-2xl font-bold text-gray-900",children:"7"}),e.jsx("p",{className:"text-[10px] text-gray-400 font-bold uppercase tracking-wider",children:t("Next: Urban Validator","Suivant : Validateur urbain")})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between px-1",children:[e.jsx("h4",{className:"text-[10px] font-bold text-gray-400 uppercase tracking-widest",children:t("Contribution History","Historique des contributions")}),e.jsx("button",{className:"text-[10px] font-bold text-[#0f2b46] uppercase",children:t("View All","Voir tout")})]}),e.jsxs("div",{className:"space-y-3",children:[A.length===0&&e.jsx("div",{className:"bg-white p-4 rounded-2xl border border-gray-100 shadow-sm text-xs text-gray-500",children:t("No contributions yet. Add your first report to build your history.","Aucune contribution pour le moment. Ajoutez votre premier signalement pour construire votre historique.")}),A.map(s=>e.jsxs("div",{className:"bg-white p-4 rounded-2xl border border-gray-100 shadow-sm flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-gray-50 flex items-center justify-center text-gray-400",children:e.jsx(_,{size:18})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-xs font-bold text-gray-900",children:s.type}),e.jsx("span",{className:"text-[10px] text-gray-400 font-bold uppercase",children:s.date}),e.jsx("span",{className:"text-[10px] text-gray-400 font-medium",children:s.location})]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("p",{className:"text-xs font-bold text-[#4c7c59]",children:["+",s.xp," XP"]})})]},s.id))]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between px-1",children:[e.jsx("h4",{className:"text-[10px] font-bold text-gray-400 uppercase tracking-widest",children:t("Sync Errors","Erreurs de synchronisation")}),u.length>0&&e.jsxs("button",{type:"button",onClick:R,disabled:b,className:`text-[10px] font-bold uppercase flex items-center space-x-1 ${b?"text-gray-300":"text-[#c86b4a]"}`,children:[e.jsx(ee,{size:12}),e.jsx("span",{children:b?t("Clearing...","Suppression..."):t("Clear","Effacer")})]})]}),z&&e.jsx("div",{className:"bg-red-50 border border-red-100 rounded-2xl p-4 text-xs text-red-600",children:z}),w&&e.jsx("div",{className:"bg-white p-4 rounded-2xl border border-gray-100 shadow-sm text-xs text-gray-500",children:t("Loading sync errors...","Chargement des erreurs de synchronisation...")}),!w&&u.length===0&&e.jsx("div",{className:"bg-white p-4 rounded-2xl border border-gray-100 shadow-sm text-xs text-gray-500",children:t("No sync errors on this device.","Aucune erreur de synchronisation sur cet appareil.")}),!w&&u.length>0&&e.jsx("div",{className:"space-y-3",children:u.map(s=>e.jsxs("div",{className:"bg-white p-4 rounded-2xl border border-red-100 shadow-sm space-y-2",children:[e.jsxs("div",{className:"flex items-start space-x-2 text-red-600",children:[e.jsx(te,{size:14,className:"mt-[1px]"}),e.jsx("span",{className:"text-xs font-semibold",children:s.message})]}),e.jsxs("div",{className:"text-[10px] text-gray-500 uppercase font-bold tracking-widest",children:[D(s.createdAt)," • ",V(s.payloadSummary.category)]}),e.jsx("div",{className:"text-[11px] text-gray-500",children:s.payloadSummary.location?`GPS: ${s.payloadSummary.location.latitude.toFixed(4)}°, ${s.payloadSummary.location.longitude.toFixed(4)}°`:t("GPS unavailable","GPS indisponible")})]},s.id))})]}),e.jsx("div",{className:"h-24"})]})]})};export{he as default};
