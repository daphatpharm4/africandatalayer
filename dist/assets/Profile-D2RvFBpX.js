import{c as j,r as n,j as e,M as Y,p as A,g as O,q as Z,u as Q}from"./index-ycbNHGav.js";import{A as ee}from"./arrow-left-C-ULJfXx.js";import{A as te,G as se}from"./gift-CgN0v535.js";import{T as ae,a as re}from"./triangle-alert-BJnwVCr7.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=[["path",{d:"M3.85 8.62a4 4 0 0 1 4.78-4.77 4 4 0 0 1 6.74 0 4 4 0 0 1 4.78 4.78 4 4 0 0 1 0 6.74 4 4 0 0 1-4.77 4.78 4 4 0 0 1-6.75 0 4 4 0 0 1-4.78-4.77 4 4 0 0 1 0-6.76Z",key:"3c2336"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],U=j("BadgeCheck",ne);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],B=j("Calendar",oe);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],le=j("Settings",ie);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=[["path",{d:"M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1",key:"18etb6"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4",key:"xoc0q4"}]],de=j("Wallet",ce),ye=({onBack:X,onSettings:G,onRedeem:H,language:p})=>{var f,_;const s=(t,r)=>p==="fr"?r:t,[a,N]=n.useState(null),[w,C]=n.useState(!0),[v,L]=n.useState(!1),[M,S]=n.useState(""),[V,x]=n.useState(s("Location not set","Position non definie")),[z,h]=n.useState([]),[u,k]=n.useState([]),[E,$]=n.useState(!0),[b,D]=n.useState(!1),[T,I]=n.useState(""),y=((t,r)=>t==="global"?"global":t==="cameroon"?r?"global":"cameroon":"bonamoussadi")(a==null?void 0:a.mapScope,!!(a!=null&&a.isAdmin))!=="bonamoussadi",F=t=>{const r=new Date(t);if(Number.isNaN(r.getTime()))return s("Unknown","Inconnu");const i=new Date,m=i.toDateString()===r.toDateString(),c=new Date(i);c.setDate(i.getDate()-1);const d=c.toDateString()===r.toDateString(),o=r.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});return m?p==="fr"?`Aujourd'hui • ${o}`:`Today • ${o}`:d?p==="fr"?`Hier • ${o}`:`Yesterday • ${o}`:`${r.toLocaleDateString([],{month:"short",day:"2-digit"})} • ${o}`},R=t=>{const r=t.details??{},m=(typeof r.siteName=="string"?r.siteName:typeof r.name=="string"?r.name:null)||`GPS: ${t.location.latitude.toFixed(4)}°, ${t.location.longitude.toFixed(4)}°`,c=t.category==="fuel_station"?s("Fuel Station","Station-service"):t.category==="pharmacy"?s("Pharmacy","Pharmacie"):s("Mobile Money Kiosk","Kiosque mobile money"),d=r.xpAwarded,o=typeof d=="number"&&Number.isFinite(d)?d:5;return{id:t.id,date:F(t.createdAt),location:m,type:c,xp:o}},K=t=>t==="fuel_station"?s("Fuel Station","Station-service"):t==="pharmacy"?s("Pharmacy","Pharmacie"):s("Mobile Money Kiosk","Kiosque mobile money");n.useEffect(()=>{(async()=>{var r,i;try{C(!0),S("");const m=await A("/api/user");N(m);try{const[c,d]=await Promise.all([O(),A("/api/submissions?view=events")]),o=(i=(r=c==null?void 0:c.user)==null?void 0:r.id)==null?void 0:i.toLowerCase().trim();if(!o){h([]),x(s("Location not set","Position non definie"));return}const q=d.filter(l=>(typeof l.userId=="string"?l.userId.toLowerCase().trim():"")===o).sort((l,P)=>new Date(P.createdAt).getTime()-new Date(l.createdAt).getTime());h(q.map(R));const g=q[0];if(g){const l=g.details??{},P=typeof l.siteName=="string"?l.siteName:typeof l.name=="string"?l.name:null;x(P||`GPS ${g.location.latitude.toFixed(4)}°, ${g.location.longitude.toFixed(4)}°`)}else x(s("No contributions yet","Pas encore de contributions"))}catch{h([]),x(s("Location not set","Position non definie"))}}catch{N(null),S(s("Unable to load profile.","Impossible de charger le profil.")),h([]),x(s("Location not set","Position non definie"))}finally{C(!1)}})()},[p]),n.useEffect(()=>{let t=!1;return(async()=>{try{$(!0);const i=await Z();t||k(i)}catch{t||k([])}finally{t||$(!1)}})(),()=>{t=!0}},[]);const J=async()=>{if(!b){I("");try{D(!0),await Q(),k([])}catch{I(s("Unable to clear sync errors.","Impossible d'effacer les erreurs de synchronisation."))}finally{D(!1)}}},W=async()=>{if(!(a!=null&&a.isAdmin)||v)return;const t=y?"bonamoussadi":"global";try{L(!0);const r=await A("/api/user",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({mapScope:t})});N(r)}catch{S(s("Unable to update map access.","Impossible de mettre a jour l'acces carte."))}finally{L(!1)}};return e.jsxs("div",{className:"flex flex-col h-full bg-[#f9fafb] overflow-y-auto no-scrollbar",children:[e.jsxs("div",{className:"sticky top-0 z-30 bg-white border-b border-gray-100 px-4 h-14 flex items-center justify-between",children:[e.jsx("button",{onClick:X,className:"p-2 -ml-2 text-gray-700 hover:text-[#0f2b46] transition-colors",children:e.jsx(ee,{size:20})}),e.jsx("h3",{className:"text-sm font-bold mx-auto",children:s("Dashboard","Tableau de bord")}),e.jsx("button",{onClick:G,className:"p-2 text-[#0f2b46] absolute right-2",children:e.jsx(le,{size:20})})]}),e.jsxs("div",{className:"p-4 space-y-6",children:[e.jsxs("div",{className:"flex flex-col items-center py-4 text-center",children:[e.jsxs("div",{className:"relative mb-4",children:[e.jsx("div",{className:"w-24 h-24 rounded-full border-4 border-white shadow-xl bg-[#e7eef4] overflow-hidden",children:e.jsx("img",{src:"https://picsum.photos/seed/jeanpaul/300/300",alt:s("avatar","avatar"),className:"w-full h-full object-cover"})}),e.jsx("div",{className:"absolute -bottom-1 -right-1 p-1 bg-[#4c7c59] rounded-full border-2 border-white",children:e.jsx(U,{size:14,className:"text-white"})})]}),e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:w?e.jsx("span",{className:"inline-block h-4 w-40 rounded-full bg-gray-200 animate-pulse"}):(a==null?void 0:a.name)||(a==null?void 0:a.phone)||(a==null?void 0:a.email)||s("Contributor","Contributeur")}),!w&&e.jsxs("div",{className:"flex items-center justify-center text-[10px] text-gray-400 mt-1 font-bold uppercase tracking-widest space-x-2",children:[e.jsx(Y,{size:12}),e.jsx("span",{children:V})]}),M&&e.jsx("div",{className:"mt-2 text-[10px] font-bold uppercase tracking-widest text-red-500",children:M}),e.jsx("div",{className:"mt-4",children:e.jsx("span",{className:"px-4 py-1.5 bg-[#e7eef4] text-[#0f2b46] text-[10px] font-bold rounded-full uppercase tracking-widest border border-[#d5e1eb] shadow-sm",children:s("Senior Contributor","Contributeur senior")})})]}),e.jsxs("div",{className:"bg-[#0f2b46] rounded-2xl p-6 text-white shadow-xl flex items-center justify-between relative overflow-hidden",children:[e.jsxs("div",{className:"relative z-10 space-y-1",children:[e.jsx("span",{className:"text-[10px] font-bold uppercase tracking-widest opacity-80",children:s("XP Balance","Solde XP")}),e.jsx("div",{className:"flex items-baseline space-x-1",children:w?e.jsx("div",{className:"h-8 w-24 rounded-lg bg-white/20 animate-pulse"}):e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"text-3xl font-extrabold tracking-tight",children:((_=(f=a==null?void 0:a.XP)==null?void 0:f.toLocaleString)==null?void 0:_.call(f))??"0"}),e.jsx("span",{className:"text-lg font-bold opacity-60",children:"XP"})]})})]}),e.jsx("div",{className:"relative z-10",children:e.jsx("div",{className:"w-12 h-12 bg-white/20 rounded-2xl flex items-center justify-center backdrop-blur-sm border border-white/30",children:e.jsx(te,{size:24})})})]}),(a==null?void 0:a.isAdmin)&&e.jsxs("div",{className:"bg-white p-5 rounded-2xl border border-gray-100 shadow-sm space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[10px] font-bold uppercase tracking-widest text-gray-400",children:s("Admin Map Access","Acces carte admin")}),e.jsx("span",{className:"text-sm font-bold text-gray-900",children:s("Unlock worldwide map","Debloquer la carte mondiale")})]}),e.jsx("button",{type:"button",onClick:W,disabled:v,className:`relative inline-flex h-7 w-14 items-center rounded-full transition-colors ${y?"bg-[#4c7c59]":"bg-gray-200"} ${v?"opacity-60":""}`,children:e.jsx("span",{className:`inline-block h-5 w-5 transform rounded-full bg-white shadow transition-transform ${y?"translate-x-8":"translate-x-1"}`})})]}),e.jsx("p",{className:"text-xs text-gray-500",children:y?s("Explorer map is unlocked worldwide.","La carte Explorer est debloquee dans le monde entier."):s("Explorer map is locked to Bonamoussadi.","La carte Explorer est limitee a Bonamoussadi.")})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("button",{onClick:H,className:"h-14 bg-white text-[#0f2b46] border border-[#d5e1eb] rounded-xl text-[10px] font-bold uppercase tracking-widest shadow-sm hover:bg-[#f2f4f7] transition-all flex items-center justify-center space-x-2",children:[e.jsx(se,{size:16}),e.jsx("span",{children:s("Redeem XP","Echanger XP")})]}),e.jsxs("button",{className:"h-14 bg-[#c86b4a] text-white rounded-xl text-[10px] font-bold uppercase tracking-widest shadow-lg hover:bg-[#b85f3f] transition-all flex items-center justify-center space-x-2",children:[e.jsx(de,{size:16}),e.jsx("span",{children:s("Convert to Rewards","Convertir en recompenses")})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-white p-5 rounded-2xl border border-gray-100 shadow-sm space-y-3",children:[e.jsxs("div",{className:"flex items-center space-x-2 text-[#4c7c59]",children:[e.jsx(U,{size:16}),e.jsx("span",{className:"text-[10px] font-bold uppercase tracking-widest",children:s("Trust Score","Score de confiance")})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-2xl font-bold text-gray-900",children:"98%"}),e.jsx("div",{className:"mt-2 h-1 w-full bg-gray-50 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-[#4c7c59] rounded-full transition-all duration-1000",style:{width:"98%"}})})]})]}),e.jsxs("div",{className:"bg-white p-5 rounded-2xl border border-gray-100 shadow-sm space-y-3",children:[e.jsxs("div",{className:"flex items-center space-x-2 text-[#0f2b46]",children:[e.jsx(B,{size:16}),e.jsx("span",{className:"text-[10px] font-bold uppercase tracking-widest",children:s("Badges","Badges")})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-2xl font-bold text-gray-900",children:"7"}),e.jsx("p",{className:"text-[10px] text-gray-400 font-bold uppercase tracking-wider",children:s("Next: Urban Validator","Suivant : Validateur urbain")})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between px-1",children:[e.jsx("h4",{className:"text-[10px] font-bold text-gray-400 uppercase tracking-widest",children:s("Contribution History","Historique des contributions")}),e.jsx("button",{className:"text-[10px] font-bold text-[#0f2b46] uppercase",children:s("View All","Voir tout")})]}),e.jsxs("div",{className:"space-y-3",children:[z.length===0&&e.jsx("div",{className:"bg-white p-4 rounded-2xl border border-gray-100 shadow-sm text-xs text-gray-500",children:s("No contributions yet. Add your first report to build your history.","Aucune contribution pour le moment. Ajoutez votre premier signalement pour construire votre historique.")}),z.map(t=>e.jsxs("div",{className:"bg-white p-4 rounded-2xl border border-gray-100 shadow-sm flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-gray-50 flex items-center justify-center text-gray-400",children:e.jsx(B,{size:18})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-xs font-bold text-gray-900",children:t.type}),e.jsx("span",{className:"text-[10px] text-gray-400 font-bold uppercase",children:t.date}),e.jsx("span",{className:"text-[10px] text-gray-400 font-medium",children:t.location})]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("p",{className:"text-xs font-bold text-[#4c7c59]",children:["+",t.xp," XP"]})})]},t.id))]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between px-1",children:[e.jsx("h4",{className:"text-[10px] font-bold text-gray-400 uppercase tracking-widest",children:s("Sync Errors","Erreurs de synchronisation")}),u.length>0&&e.jsxs("button",{type:"button",onClick:J,disabled:b,className:`text-[10px] font-bold uppercase flex items-center space-x-1 ${b?"text-gray-300":"text-[#c86b4a]"}`,children:[e.jsx(ae,{size:12}),e.jsx("span",{children:b?s("Clearing...","Suppression..."):s("Clear","Effacer")})]})]}),T&&e.jsx("div",{className:"bg-red-50 border border-red-100 rounded-2xl p-4 text-xs text-red-600",children:T}),E&&e.jsx("div",{className:"bg-white p-4 rounded-2xl border border-gray-100 shadow-sm text-xs text-gray-500",children:s("Loading sync errors...","Chargement des erreurs de synchronisation...")}),!E&&u.length===0&&e.jsx("div",{className:"bg-white p-4 rounded-2xl border border-gray-100 shadow-sm text-xs text-gray-500",children:s("No sync errors on this device.","Aucune erreur de synchronisation sur cet appareil.")}),!E&&u.length>0&&e.jsx("div",{className:"space-y-3",children:u.map(t=>e.jsxs("div",{className:"bg-white p-4 rounded-2xl border border-red-100 shadow-sm space-y-2",children:[e.jsxs("div",{className:"flex items-start space-x-2 text-red-600",children:[e.jsx(re,{size:14,className:"mt-[1px]"}),e.jsx("span",{className:"text-xs font-semibold",children:t.message})]}),e.jsxs("div",{className:"text-[10px] text-gray-500 uppercase font-bold tracking-widest",children:[F(t.createdAt)," • ",K(t.payloadSummary.category)]}),e.jsx("div",{className:"text-[11px] text-gray-500",children:t.payloadSummary.location?`GPS: ${t.payloadSummary.location.latitude.toFixed(4)}°, ${t.payloadSummary.location.longitude.toFixed(4)}°`:s("GPS unavailable","GPS indisponible")})]},t.id))})]}),e.jsx("div",{className:"h-24"})]})]})};export{ye as default};
