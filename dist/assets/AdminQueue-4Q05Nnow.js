import{c as B,r as x,j as e,S as J,h as Q,U as W,M as Y,p as V,q as Z,u as F,y as ee}from"./index-BN4FHHoZ.js";import{A as se}from"./arrow-left-CA59DKQq.js";import{a as re,T as te}from"./triangle-alert-zRlH8E5r.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],ie=B("X",ne);function E(t,r){return t?`${t.latitude.toFixed(5)}°, ${t.longitude.toFixed(5)}°`:r}function C(t,r){return typeof t!="number"||!Number.isFinite(t)?r:`${t.toFixed(3)} km`}function U(t,r){if(!t)return r;const s=new Date(t);return Number.isNaN(s.getTime())?r:s.toLocaleString()}function K(t,r){return t==="pharmacy"?r==="fr"?"Pharmacie":"Pharmacy":t==="fuel_station"?r==="fr"?"Station-service":"Fuel Station":r==="fr"?"Kiosque mobile money":"Mobile Money Kiosk"}function oe(t,r){const s=t.event.details;return typeof s.siteName=="string"&&s.siteName.trim()?s.siteName.trim():typeof s.name=="string"&&s.name.trim()?s.name.trim():r==="fr"?"Soumission sans nom":"Unnamed submission"}function R(t){if(typeof t.event.photoUrl=="string"&&t.event.photoUrl.trim())return t.event.photoUrl;const r=t.event.details;return typeof r.secondPhotoUrl=="string"&&r.secondPhotoUrl.trim()?r.secondPhotoUrl:null}function ce(t){const r=t.event.details;return typeof r.secondPhotoUrl=="string"&&r.secondPhotoUrl.trim()?r.secondPhotoUrl:null}function ae(t){const r=t.event.details;if(!r.clientDevice||typeof r.clientDevice!="object")return null;const s=r.clientDevice;return typeof s.deviceId!="string"||!s.deviceId.trim()?null:{deviceId:s.deviceId.trim(),platform:typeof s.platform=="string"?s.platform.trim():void 0,userAgent:typeof s.userAgent=="string"?s.userAgent.trim():void 0,deviceMemoryGb:typeof s.deviceMemoryGb=="number"&&Number.isFinite(s.deviceMemoryGb)?s.deviceMemoryGb:null,hardwareConcurrency:typeof s.hardwareConcurrency=="number"&&Number.isFinite(s.hardwareConcurrency)?s.hardwareConcurrency:null,isLowEnd:s.isLowEnd===!0}}function _(t){const r=typeof t.event.source=="string"?t.event.source.trim().toLowerCase():"";return!!(r==="legacy_submission"||r==="osm_overpass"||t.event.id.startsWith("legacy-event-"))}function le(t){var s;const r=(s=t==null?void 0:t.primaryPhoto)==null?void 0:s.submissionGpsMatch;return r===!0?"match":r===!1?"mismatch":"unavailable"}function de(t,r){return t==="match"?r==="fr"?"OK":"Match":t==="mismatch"?r==="fr"?"Ecart":"Mismatch":r==="fr"?"Indisponible":"Unavailable"}function xe(t){return t==="match"?"text-[#4c7c59] bg-[#eaf3ee] border-[#d2e6d8]":t==="mismatch"?"text-[#c86b4a] bg-[#fdf0ea] border-[#f4d5c6]":"text-gray-500 bg-gray-100 border-gray-200"}const O=({label:t,metadata:r,thresholdKm:s,unavailable:l,language:v})=>{const c=(N,m)=>v==="fr"?m:N,b=r==null?void 0:r.submissionGpsMatch,j=b===!0?c("Match","OK"):b===!1?c("Mismatch","Ecart"):c("Unavailable","Indisponible"),y=b===!0?"text-[#4c7c59]":b===!1?"text-[#c86b4a]":"text-gray-500";return e.jsxs("div",{className:"rounded-2xl border border-gray-100 bg-[#f9fafb] p-4 space-y-2",children:[e.jsx("div",{className:"text-[10px] font-bold uppercase tracking-widest text-[#0f2b46]",children:t}),e.jsxs("div",{className:"flex items-center justify-between text-[11px]",children:[e.jsx("span",{className:"text-gray-500",children:c("Photo EXIF GPS","GPS EXIF photo")}),e.jsx("span",{className:"text-gray-800",children:E(r==null?void 0:r.gps,l)})]}),e.jsxs("div",{className:"flex items-center justify-between text-[11px]",children:[e.jsx("span",{className:"text-gray-500",children:c("Capture Time","Heure de capture")}),e.jsx("span",{className:"text-gray-800",children:U(r==null?void 0:r.capturedAt,l)})]}),e.jsxs("div",{className:"flex items-center justify-between text-[11px]",children:[e.jsx("span",{className:"text-gray-500",children:c("Device","Appareil")}),e.jsx("span",{className:"text-gray-800",children:r!=null&&r.deviceMake||r!=null&&r.deviceModel?`${(r==null?void 0:r.deviceMake)??""} ${(r==null?void 0:r.deviceModel)??""}`.trim():l})]}),e.jsxs("div",{className:"flex items-center justify-between text-[11px]",children:[e.jsx("span",{className:"text-gray-500",children:c("Distance to Submission GPS","Distance au GPS soumis")}),e.jsx("span",{className:"text-gray-800",children:C(r==null?void 0:r.submissionDistanceKm,l)})]}),e.jsxs("div",{className:"flex items-center justify-between text-[11px]",children:[e.jsx("span",{className:"text-gray-500",children:c("Distance to IP GPS","Distance au GPS IP")}),e.jsx("span",{className:"text-gray-800",children:C(r==null?void 0:r.ipDistanceKm,l)})]}),e.jsxs("div",{className:"flex items-center justify-between text-[11px]",children:[e.jsx("span",{className:"text-gray-500",children:c("Submission GPS Match","Correspondance GPS soumission")}),e.jsx("span",{className:y,children:j})]}),e.jsxs("div",{className:"text-[10px] text-gray-400 uppercase font-bold tracking-widest",children:[c("Threshold","Seuil"),": ",s," km"]})]})},fe=({onBack:t,language:r})=>{var z;const s=(i,a)=>r==="fr"?a:i,[l,v]=x.useState(!0),[c,b]=x.useState(""),[j,y]=x.useState(""),[N,m]=x.useState(""),[M,A]=x.useState(!1),[w,I]=x.useState([]),[n,g]=x.useState(null),[D,k]=x.useState([]),[S,G]=x.useState(!1);x.useEffect(()=>{let i=!1;return(async()=>{try{v(!0),b(""),m(""),y("");const d=await V("/api/submissions?view=admin_events&scope=global");if(i)return;const u=Array.isArray(d)?d:[];I(u),g(h=>h?u.find(H=>H.event.id===h.event.id)??u[0]??null:u[0]??null)}catch(d){if(i)return;const u=d instanceof Error?d.message:s("Unable to load submissions.","Impossible de charger les soumissions.");b(u),I([]),g(null)}finally{i||v(!1)}})(),()=>{i=!0}},[r]),x.useEffect(()=>{let i=!1;return(async()=>{try{const d=await Z();i||k(d)}catch{i||k([])}})(),()=>{i=!0}},[]),x.useEffect(()=>{m(""),y("")},[n==null?void 0:n.event.id]);const o=(n==null?void 0:n.fraudCheck)??null,T=n?R(n):null,$=n?ce(n):null,f=n?ae(n):null,P=n?_(n):!1,p=s("Unavailable","Indisponible"),L=x.useMemo(()=>w.map(i=>{const a=le(i.fraudCheck);return{item:i,state:a,siteName:oe(i,r),preview:R(i)}}),[w,r]),X=async()=>{if(!n)return;if(_(n)){m(s("This submission source is read-only and cannot be deleted.","Cette source de soumission est en lecture seule et ne peut pas etre supprimee."));return}if(window.confirm(s("Delete this submission event permanently?","Supprimer definitivement cet evenement de soumission ?"))){A(!0),m(""),y("");try{const a=await ee(`/api/submissions/${encodeURIComponent(n.event.id)}?view=event`,{method:"DELETE"});if(!a.ok){const h=await a.text()||s("Unable to delete submission.","Impossible de supprimer la soumission.");m(h);return}const d=n.event.id,u=w.filter(h=>h.event.id!==d);I(u),g(u[0]??null),y(s("Submission deleted successfully.","Soumission supprimee avec succes."))}catch(a){const d=a instanceof Error?a.message:s("Unable to delete submission.","Impossible de supprimer la soumission.");m(d)}finally{A(!1)}}},q=async()=>{if(!S)try{G(!0),await F(),k([])}finally{G(!1)}};return e.jsxs("div",{className:"flex flex-col h-full bg-[#f9fafb] overflow-y-auto no-scrollbar",children:[e.jsxs("div",{className:"sticky top-0 z-30 bg-[#1f2933] text-white px-4 h-14 flex items-center justify-between",children:[e.jsx("button",{onClick:t,className:"p-2 -ml-2 hover:text-[#c86b4a] transition-colors",children:e.jsx(se,{size:20})}),e.jsx("h3",{className:"text-xs font-bold uppercase tracking-[0.2em]",children:s("Submission Forensics","Analyse forensique")}),e.jsx(J,{size:18,className:"text-[#c86b4a]"})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"bg-white border border-gray-100 rounded-xl p-3 text-[10px] font-bold uppercase tracking-widest text-gray-500 flex items-center justify-between",children:[e.jsx("span",{children:s("Global Admin Scope","Portee admin globale")}),e.jsxs("span",{children:[w.length," ",s("items","elements")]})]}),D.length>0&&e.jsxs("div",{className:"bg-red-50 border border-red-100 rounded-2xl p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center space-x-2 text-red-700",children:[e.jsx(re,{size:14}),e.jsxs("span",{className:"text-[10px] font-bold uppercase tracking-widest",children:[s("Local Sync Errors","Erreurs locales de synchronisation")," (",D.length,")"]})]}),e.jsx("button",{type:"button",onClick:q,disabled:S,className:`text-[10px] font-bold uppercase tracking-widest ${S?"text-red-300":"text-red-700"}`,children:S?s("Clearing...","Suppression..."):s("Clear","Effacer")})]}),e.jsx("div",{className:"text-xs text-red-700",children:((z=D[0])==null?void 0:z.message)??s("Unknown sync error.","Erreur de synchronisation inconnue.")})]}),l&&e.jsx("div",{className:"bg-white border border-gray-100 rounded-2xl p-5 text-xs text-gray-500",children:s("Loading submissions...","Chargement des soumissions...")}),!l&&c&&e.jsx("div",{className:"bg-red-50 border border-red-100 rounded-2xl p-5 text-xs text-red-600",children:c}),!l&&!c&&j&&e.jsx("div",{className:"bg-[#eaf3ee] border border-[#d2e6d8] rounded-2xl p-4 text-xs text-[#2f855a]",children:j}),!l&&!c&&N&&e.jsx("div",{className:"bg-red-50 border border-red-100 rounded-2xl p-4 text-xs text-red-600",children:N}),!l&&!c&&n&&e.jsxs("div",{className:"bg-white rounded-2xl border border-gray-100 shadow-sm p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"text-sm font-bold text-gray-900",children:s("Submission Detail","Detail de la soumission")}),e.jsx("button",{type:"button",onClick:()=>g(null),className:"h-8 w-8 rounded-full border border-gray-100 text-gray-500 hover:text-gray-900 flex items-center justify-center",children:e.jsx(ie,{size:14})})]}),e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("p",{className:"text-[10px] text-gray-400 uppercase tracking-widest font-bold",children:P?s("Read-only source","Source en lecture seule"):s("Admin action","Action admin")}),e.jsxs("button",{type:"button",onClick:X,disabled:M||P,className:`h-10 px-3 rounded-xl text-[10px] font-bold uppercase tracking-widest flex items-center space-x-2 ${M||P?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-red-50 border border-red-100 text-red-600 hover:bg-red-100"}`,children:[e.jsx(te,{size:14}),e.jsx("span",{children:M?s("Deleting...","Suppression..."):P?s("Cannot delete","Suppression impossible"):s("Delete submission","Supprimer soumission")})]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-3 text-[11px]",children:[e.jsxs("div",{className:"rounded-2xl border border-gray-100 p-3 space-y-1",children:[e.jsx("div",{className:"text-[10px] font-bold uppercase tracking-widest text-gray-400",children:s("Submitter","Soumis par")}),e.jsx("div",{className:"text-gray-900 font-semibold",children:n.user.name}),e.jsx("div",{className:"text-gray-600",children:n.user.email??p}),e.jsxs("div",{className:"text-gray-500",children:["ID: ",n.user.id]})]}),e.jsxs("div",{className:"rounded-2xl border border-gray-100 p-3 space-y-1",children:[e.jsx("div",{className:"text-[10px] font-bold uppercase tracking-widest text-gray-400",children:s("Submission Metadata","Metadonnees soumission")}),e.jsxs("div",{children:[s("Time","Heure"),": ",U(n.event.createdAt,p)]}),e.jsxs("div",{children:[s("Event Type","Type d'evenement"),": ",n.event.eventType]}),e.jsxs("div",{children:[s("Category","Categorie"),": ",K(n.event.category,r)]}),e.jsxs("div",{children:["Point ID: ",n.event.pointId]})]}),e.jsxs("div",{className:"rounded-2xl border border-gray-100 p-3 space-y-1",children:[e.jsx("div",{className:"text-[10px] font-bold uppercase tracking-widest text-gray-400",children:s("Client Device","Appareil client")}),e.jsxs("div",{children:[s("Device ID","Device ID"),": ",(f==null?void 0:f.deviceId)??p]}),e.jsxs("div",{children:[s("Platform","Plateforme"),": ",(f==null?void 0:f.platform)??p]}),e.jsxs("div",{children:[s("Low-end flag","Indicateur entree de gamme"),":"," ",f?f.isLowEnd===!0?s("Yes","Oui"):s("No","Non"):p]})]}),e.jsxs("div",{className:"rounded-2xl border border-gray-100 p-3 space-y-1",children:[e.jsx("div",{className:"text-[10px] font-bold uppercase tracking-widest text-gray-400",children:s("Location","Localisation")}),e.jsxs("div",{children:[s("Submission GPS","GPS soumis"),": ",E(o==null?void 0:o.submissionLocation,p)]}),e.jsxs("div",{children:[s("Effective GPS","GPS effectif"),": ",E(o==null?void 0:o.effectiveLocation,p)]}),e.jsxs("div",{children:[s("IP GPS","GPS IP"),": ",E(o==null?void 0:o.ipLocation,p)]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-[10px] font-bold uppercase tracking-widest text-gray-400",children:s("Photos","Photos")}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx("div",{className:"rounded-2xl border border-gray-100 overflow-hidden bg-gray-50 h-28 flex items-center justify-center",children:T?e.jsx("img",{src:T,alt:s("Primary photo","Photo principale"),className:"h-full w-full object-cover"}):e.jsx("div",{className:"text-[10px] text-gray-400 font-bold uppercase tracking-widest text-center px-2",children:s("Primary photo unavailable","Photo principale indisponible")})}),e.jsx("div",{className:"rounded-2xl border border-gray-100 overflow-hidden bg-gray-50 h-28 flex items-center justify-center",children:$?e.jsx("img",{src:$,alt:s("Secondary photo","Photo secondaire"),className:"h-full w-full object-cover"}):e.jsx("div",{className:"text-[10px] text-gray-400 font-bold uppercase tracking-widest text-center px-2",children:s("Secondary photo unavailable","Photo secondaire indisponible")})})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"text-[10px] font-bold uppercase tracking-widest text-gray-400",children:s("Fraud Metadata","Metadonnees anti-fraude")}),e.jsx(O,{label:s("Primary Photo Metadata","Metadonnees photo principale"),metadata:(o==null?void 0:o.primaryPhoto)??null,thresholdKm:(o==null?void 0:o.submissionMatchThresholdKm)??1,unavailable:p,language:r}),e.jsx(O,{label:s("Secondary Photo Metadata","Metadonnees photo secondaire"),metadata:(o==null?void 0:o.secondaryPhoto)??null,thresholdKm:(o==null?void 0:o.submissionMatchThresholdKm)??1,unavailable:p,language:r}),e.jsxs("div",{className:"text-[10px] text-gray-400 uppercase tracking-widest font-bold",children:[s("IP Match Threshold","Seuil correspondance IP"),": ",(o==null?void 0:o.ipMatchThresholdKm)??50," km"]})]})]})]}),!l&&!c&&L.length===0&&e.jsx("div",{className:"bg-white border border-gray-100 rounded-2xl p-6 text-xs text-gray-500 text-center",children:s("No submissions found.","Aucune soumission trouvee.")}),!l&&!c&&L.length>0&&e.jsx("div",{className:"space-y-3",children:L.map(({item:i,state:a,siteName:d,preview:u})=>{const h=(n==null?void 0:n.event.id)===i.event.id;return e.jsx("button",{type:"button",onClick:()=>g(i),className:`w-full text-left bg-white border rounded-2xl overflow-hidden shadow-sm transition-colors ${h?"border-[#0f2b46]":"border-gray-100 hover:border-[#d5e1eb]"}`,children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"w-24 h-24 bg-gray-100 shrink-0 flex items-center justify-center",children:u?e.jsx("img",{src:u,alt:s("submission","soumission"),className:"h-full w-full object-cover"}):e.jsx(Q,{size:18,className:"text-gray-300"})}),e.jsxs("div",{className:"flex-1 p-3 space-y-2",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-bold text-gray-900 leading-tight",children:d}),e.jsx("p",{className:"text-[10px] uppercase tracking-widest text-gray-400",children:K(i.event.category,r)})]}),e.jsx("span",{className:`text-[10px] font-bold uppercase tracking-widest px-2 py-1 rounded-lg border ${xe(a)}`,children:de(a,r)})]}),e.jsxs("div",{className:"text-[11px] text-gray-600 flex items-center gap-1",children:[e.jsx(W,{size:12}),e.jsx("span",{children:i.user.name}),e.jsx("span",{className:"text-gray-400",children:"•"}),e.jsx("span",{className:"truncate",children:i.user.email??i.user.id})]}),e.jsxs("div",{className:"text-[11px] text-gray-500 flex items-center gap-1",children:[e.jsx(Y,{size:12}),e.jsx("span",{children:U(i.event.createdAt,p)})]})]})]})},i.event.id)})})]})]})};export{fe as default};
