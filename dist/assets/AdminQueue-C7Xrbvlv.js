import{c as H,r as x,j as e,S as B,h as J,U as Q,M as W,p as Y,q as V,u as Z,y as ee}from"./index-BUG7berd.js";import{A as se}from"./arrow-left-BGn11AE0.js";import{a as re,T as te}from"./triangle-alert-DzWukc-i.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],ie=H("X",ne);function oe(t,s){return t==="ok"?"EXIF present":t==="fallback_recovered"?s==="fr"?"Recupere via URL":"Recovered via URL":t==="missing"?s==="fr"?"EXIF absent":"EXIF missing":t==="unsupported_format"?s==="fr"?"Format non supporte":"Unsupported format":t==="parse_error"?s==="fr"?"Erreur de lecture EXIF":"EXIF parse error":s==="fr"?"Indisponible":"Unavailable"}function ce(t,s){return t==="upload_buffer"?s==="fr"?"Upload initial":"Initial upload":t==="remote_url"?s==="fr"?"Photo distante":"Remote photo":t==="none"?s==="fr"?"Aucune source":"No source":s==="fr"?"Indisponible":"Unavailable"}function M(t,s){return t?`${t.latitude.toFixed(5)}°, ${t.longitude.toFixed(5)}°`:s}function _(t,s){return typeof t!="number"||!Number.isFinite(t)?s:`${t.toFixed(3)} km`}function A(t,s){if(!t)return s;const r=new Date(t);return Number.isNaN(r.getTime())?s:r.toLocaleString()}function F(t,s){return t==="pharmacy"?s==="fr"?"Pharmacie":"Pharmacy":t==="fuel_station"?s==="fr"?"Station-service":"Fuel Station":s==="fr"?"Kiosque mobile money":"Mobile Money Kiosk"}function le(t,s){const r=t.event.details;return typeof r.siteName=="string"&&r.siteName.trim()?r.siteName.trim():typeof r.name=="string"&&r.name.trim()?r.name.trim():s==="fr"?"Soumission sans nom":"Unnamed submission"}function $(t){if(typeof t.event.photoUrl=="string"&&t.event.photoUrl.trim())return t.event.photoUrl;const s=t.event.details;return typeof s.secondPhotoUrl=="string"&&s.secondPhotoUrl.trim()?s.secondPhotoUrl:null}function ae(t){const s=t.event.details;return typeof s.secondPhotoUrl=="string"&&s.secondPhotoUrl.trim()?s.secondPhotoUrl:null}function de(t){const s=t.event.details;if(!s.clientDevice||typeof s.clientDevice!="object")return null;const r=s.clientDevice;return typeof r.deviceId!="string"||!r.deviceId.trim()?null:{deviceId:r.deviceId.trim(),platform:typeof r.platform=="string"?r.platform.trim():void 0,userAgent:typeof r.userAgent=="string"?r.userAgent.trim():void 0,deviceMemoryGb:typeof r.deviceMemoryGb=="number"&&Number.isFinite(r.deviceMemoryGb)?r.deviceMemoryGb:null,hardwareConcurrency:typeof r.hardwareConcurrency=="number"&&Number.isFinite(r.hardwareConcurrency)?r.hardwareConcurrency:null,isLowEnd:r.isLowEnd===!0}}function z(t){const s=typeof t.event.source=="string"?t.event.source.trim().toLowerCase():"";return!!(s==="legacy_submission"||s==="osm_overpass"||t.event.id.startsWith("legacy-event-"))}function xe(t){var r;const s=(r=t==null?void 0:t.primaryPhoto)==null?void 0:r.submissionGpsMatch;return s===!0?"match":s===!1?"mismatch":"unavailable"}function ue(t,s){return t==="match"?s==="fr"?"OK":"Match":t==="mismatch"?s==="fr"?"Ecart":"Mismatch":s==="fr"?"Indisponible":"Unavailable"}function pe(t){return t==="match"?"text-[#4c7c59] bg-[#eaf3ee] border-[#d2e6d8]":t==="mismatch"?"text-[#c86b4a] bg-[#fdf0ea] border-[#f4d5c6]":"text-gray-500 bg-gray-100 border-gray-200"}const C=({label:t,metadata:s,thresholdKm:r,unavailable:l,language:y})=>{const c=(P,j)=>y==="fr"?j:P,b=s==null?void 0:s.submissionGpsMatch,S=b===!0?c("Match","OK"):b===!1?c("Mismatch","Ecart"):c("Unavailable","Indisponible"),v=b===!0?"text-[#4c7c59]":b===!1?"text-[#c86b4a]":"text-gray-500",w=s?oe(s.exifStatus,y):l,f=(s==null?void 0:s.exifReason)??l,g=s?ce(s.exifSource,y):l;return e.jsxs("div",{className:"rounded-2xl border border-gray-100 bg-[#f9fafb] p-4 space-y-2",children:[e.jsx("div",{className:"text-[10px] font-bold uppercase tracking-widest text-[#0f2b46]",children:t}),e.jsxs("div",{className:"flex items-center justify-between text-[11px]",children:[e.jsx("span",{className:"text-gray-500",children:c("EXIF Status","Statut EXIF")}),e.jsx("span",{className:"text-gray-800",children:w})]}),e.jsxs("div",{className:"flex items-center justify-between text-[11px]",children:[e.jsx("span",{className:"text-gray-500",children:c("EXIF Source","Source EXIF")}),e.jsx("span",{className:"text-gray-800",children:g})]}),e.jsxs("div",{className:"text-[11px]",children:[e.jsx("div",{className:"text-gray-500",children:c("EXIF Reason","Raison EXIF")}),e.jsx("div",{className:"text-gray-800 break-words",children:f})]}),e.jsxs("div",{className:"flex items-center justify-between text-[11px]",children:[e.jsx("span",{className:"text-gray-500",children:c("Photo EXIF GPS","GPS EXIF photo")}),e.jsx("span",{className:"text-gray-800",children:M(s==null?void 0:s.gps,l)})]}),e.jsxs("div",{className:"flex items-center justify-between text-[11px]",children:[e.jsx("span",{className:"text-gray-500",children:c("Capture Time","Heure de capture")}),e.jsx("span",{className:"text-gray-800",children:A(s==null?void 0:s.capturedAt,l)})]}),e.jsxs("div",{className:"flex items-center justify-between text-[11px]",children:[e.jsx("span",{className:"text-gray-500",children:c("Device","Appareil")}),e.jsx("span",{className:"text-gray-800",children:s!=null&&s.deviceMake||s!=null&&s.deviceModel?`${(s==null?void 0:s.deviceMake)??""} ${(s==null?void 0:s.deviceModel)??""}`.trim():l})]}),e.jsxs("div",{className:"flex items-center justify-between text-[11px]",children:[e.jsx("span",{className:"text-gray-500",children:c("Distance to Submission GPS","Distance au GPS soumis")}),e.jsx("span",{className:"text-gray-800",children:_(s==null?void 0:s.submissionDistanceKm,l)})]}),e.jsxs("div",{className:"flex items-center justify-between text-[11px]",children:[e.jsx("span",{className:"text-gray-500",children:c("Distance to IP GPS","Distance au GPS IP")}),e.jsx("span",{className:"text-gray-800",children:_(s==null?void 0:s.ipDistanceKm,l)})]}),e.jsxs("div",{className:"flex items-center justify-between text-[11px]",children:[e.jsx("span",{className:"text-gray-500",children:c("Submission GPS Match","Correspondance GPS soumission")}),e.jsx("span",{className:v,children:S})]}),e.jsxs("div",{className:"text-[10px] text-gray-400 uppercase font-bold tracking-widest",children:[c("Threshold","Seuil"),": ",r," km"]})]})},be=({onBack:t,language:s})=>{var X;const r=(i,a)=>s==="fr"?a:i,[l,y]=x.useState(!0),[c,b]=x.useState(""),[S,v]=x.useState(""),[w,f]=x.useState(""),[g,P]=x.useState(!1),[j,D]=x.useState([]),[n,N]=x.useState(null),[U,L]=x.useState([]),[E,G]=x.useState(!1);x.useEffect(()=>{let i=!1;return(async()=>{try{y(!0),b(""),f(""),v("");const d=await Y("/api/submissions?view=admin_events&scope=global");if(i)return;const u=Array.isArray(d)?d:[];D(u),N(h=>h?u.find(q=>q.event.id===h.event.id)??u[0]??null:u[0]??null)}catch(d){if(i)return;const u=d instanceof Error?d.message:r("Unable to load submissions.","Impossible de charger les soumissions.");b(u),D([]),N(null)}finally{i||y(!1)}})(),()=>{i=!0}},[s]),x.useEffect(()=>{let i=!1;return(async()=>{try{const d=await V();i||L(d)}catch{i||L([])}})(),()=>{i=!0}},[]),x.useEffect(()=>{f(""),v("")},[n==null?void 0:n.event.id]);const o=(n==null?void 0:n.fraudCheck)??null,T=n?$(n):null,R=n?ae(n):null,m=n?de(n):null,I=n?z(n):!1,p=r("Unavailable","Indisponible"),k=x.useMemo(()=>j.map(i=>{const a=xe(i.fraudCheck);return{item:i,state:a,siteName:le(i,s),preview:$(i)}}),[j,s]),K=async()=>{if(!n)return;if(z(n)){f(r("This submission source is read-only and cannot be deleted.","Cette source de soumission est en lecture seule et ne peut pas etre supprimee."));return}if(window.confirm(r("Delete this submission event permanently?","Supprimer definitivement cet evenement de soumission ?"))){P(!0),f(""),v("");try{const a=await ee(`/api/submissions/${encodeURIComponent(n.event.id)}?view=event`,{method:"DELETE"});if(!a.ok){const h=await a.text()||r("Unable to delete submission.","Impossible de supprimer la soumission.");f(h);return}const d=n.event.id,u=j.filter(h=>h.event.id!==d);D(u),N(u[0]??null),v(r("Submission deleted successfully.","Soumission supprimee avec succes."))}catch(a){const d=a instanceof Error?a.message:r("Unable to delete submission.","Impossible de supprimer la soumission.");f(d)}finally{P(!1)}}},O=async()=>{if(!E)try{G(!0),await Z(),L([])}finally{G(!1)}};return e.jsxs("div",{className:"flex flex-col h-full bg-[#f9fafb] overflow-y-auto no-scrollbar",children:[e.jsxs("div",{className:"sticky top-0 z-30 bg-[#1f2933] text-white px-4 h-14 flex items-center justify-between",children:[e.jsx("button",{onClick:t,className:"p-2 -ml-2 hover:text-[#c86b4a] transition-colors",children:e.jsx(se,{size:20})}),e.jsx("h3",{className:"text-xs font-bold uppercase tracking-[0.2em]",children:r("Submission Forensics","Analyse forensique")}),e.jsx(B,{size:18,className:"text-[#c86b4a]"})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"bg-white border border-gray-100 rounded-xl p-3 text-[10px] font-bold uppercase tracking-widest text-gray-500 flex items-center justify-between",children:[e.jsx("span",{children:r("Global Admin Scope","Portee admin globale")}),e.jsxs("span",{children:[j.length," ",r("items","elements")]})]}),U.length>0&&e.jsxs("div",{className:"bg-red-50 border border-red-100 rounded-2xl p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center space-x-2 text-red-700",children:[e.jsx(re,{size:14}),e.jsxs("span",{className:"text-[10px] font-bold uppercase tracking-widest",children:[r("Local Sync Errors","Erreurs locales de synchronisation")," (",U.length,")"]})]}),e.jsx("button",{type:"button",onClick:O,disabled:E,className:`text-[10px] font-bold uppercase tracking-widest ${E?"text-red-300":"text-red-700"}`,children:E?r("Clearing...","Suppression..."):r("Clear","Effacer")})]}),e.jsx("div",{className:"text-xs text-red-700",children:((X=U[0])==null?void 0:X.message)??r("Unknown sync error.","Erreur de synchronisation inconnue.")})]}),l&&e.jsx("div",{className:"bg-white border border-gray-100 rounded-2xl p-5 text-xs text-gray-500",children:r("Loading submissions...","Chargement des soumissions...")}),!l&&c&&e.jsx("div",{className:"bg-red-50 border border-red-100 rounded-2xl p-5 text-xs text-red-600",children:c}),!l&&!c&&S&&e.jsx("div",{className:"bg-[#eaf3ee] border border-[#d2e6d8] rounded-2xl p-4 text-xs text-[#2f855a]",children:S}),!l&&!c&&w&&e.jsx("div",{className:"bg-red-50 border border-red-100 rounded-2xl p-4 text-xs text-red-600",children:w}),!l&&!c&&n&&e.jsxs("div",{className:"bg-white rounded-2xl border border-gray-100 shadow-sm p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"text-sm font-bold text-gray-900",children:r("Submission Detail","Detail de la soumission")}),e.jsx("button",{type:"button",onClick:()=>N(null),className:"h-8 w-8 rounded-full border border-gray-100 text-gray-500 hover:text-gray-900 flex items-center justify-center",children:e.jsx(ie,{size:14})})]}),e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("p",{className:"text-[10px] text-gray-400 uppercase tracking-widest font-bold",children:I?r("Read-only source","Source en lecture seule"):r("Admin action","Action admin")}),e.jsxs("button",{type:"button",onClick:K,disabled:g||I,className:`h-10 px-3 rounded-xl text-[10px] font-bold uppercase tracking-widest flex items-center space-x-2 ${g||I?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-red-50 border border-red-100 text-red-600 hover:bg-red-100"}`,children:[e.jsx(te,{size:14}),e.jsx("span",{children:g?r("Deleting...","Suppression..."):I?r("Cannot delete","Suppression impossible"):r("Delete submission","Supprimer soumission")})]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-3 text-[11px]",children:[e.jsxs("div",{className:"rounded-2xl border border-gray-100 p-3 space-y-1",children:[e.jsx("div",{className:"text-[10px] font-bold uppercase tracking-widest text-gray-400",children:r("Submitter","Soumis par")}),e.jsx("div",{className:"text-gray-900 font-semibold",children:n.user.name}),e.jsx("div",{className:"text-gray-600",children:n.user.email??p}),e.jsxs("div",{className:"text-gray-500",children:["ID: ",n.user.id]})]}),e.jsxs("div",{className:"rounded-2xl border border-gray-100 p-3 space-y-1",children:[e.jsx("div",{className:"text-[10px] font-bold uppercase tracking-widest text-gray-400",children:r("Submission Metadata","Metadonnees soumission")}),e.jsxs("div",{children:[r("Time","Heure"),": ",A(n.event.createdAt,p)]}),e.jsxs("div",{children:[r("Event Type","Type d'evenement"),": ",n.event.eventType]}),e.jsxs("div",{children:[r("Category","Categorie"),": ",F(n.event.category,s)]}),e.jsxs("div",{children:["Point ID: ",n.event.pointId]})]}),e.jsxs("div",{className:"rounded-2xl border border-gray-100 p-3 space-y-1",children:[e.jsx("div",{className:"text-[10px] font-bold uppercase tracking-widest text-gray-400",children:r("Client Device","Appareil client")}),e.jsxs("div",{children:[r("Device ID","Device ID"),": ",(m==null?void 0:m.deviceId)??p]}),e.jsxs("div",{children:[r("Platform","Plateforme"),": ",(m==null?void 0:m.platform)??p]}),e.jsxs("div",{children:[r("Low-end flag","Indicateur entree de gamme"),":"," ",m?m.isLowEnd===!0?r("Yes","Oui"):r("No","Non"):p]})]}),e.jsxs("div",{className:"rounded-2xl border border-gray-100 p-3 space-y-1",children:[e.jsx("div",{className:"text-[10px] font-bold uppercase tracking-widest text-gray-400",children:r("Location","Localisation")}),e.jsxs("div",{children:[r("Submission GPS","GPS soumis"),": ",M(o==null?void 0:o.submissionLocation,p)]}),e.jsxs("div",{children:[r("Effective GPS","GPS effectif"),": ",M(o==null?void 0:o.effectiveLocation,p)]}),e.jsxs("div",{children:[r("IP GPS","GPS IP"),": ",M(o==null?void 0:o.ipLocation,p)]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-[10px] font-bold uppercase tracking-widest text-gray-400",children:r("Photos","Photos")}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx("div",{className:"rounded-2xl border border-gray-100 overflow-hidden bg-gray-50 h-28 flex items-center justify-center",children:T?e.jsx("img",{src:T,alt:r("Primary photo","Photo principale"),className:"h-full w-full object-cover"}):e.jsx("div",{className:"text-[10px] text-gray-400 font-bold uppercase tracking-widest text-center px-2",children:r("Primary photo unavailable","Photo principale indisponible")})}),e.jsx("div",{className:"rounded-2xl border border-gray-100 overflow-hidden bg-gray-50 h-28 flex items-center justify-center",children:R?e.jsx("img",{src:R,alt:r("Secondary photo","Photo secondaire"),className:"h-full w-full object-cover"}):e.jsx("div",{className:"text-[10px] text-gray-400 font-bold uppercase tracking-widest text-center px-2",children:r("Secondary photo unavailable","Photo secondaire indisponible")})})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"text-[10px] font-bold uppercase tracking-widest text-gray-400",children:r("Fraud Metadata","Metadonnees anti-fraude")}),e.jsx(C,{label:r("Primary Photo Metadata","Metadonnees photo principale"),metadata:(o==null?void 0:o.primaryPhoto)??null,thresholdKm:(o==null?void 0:o.submissionMatchThresholdKm)??1,unavailable:p,language:s}),e.jsx(C,{label:r("Secondary Photo Metadata","Metadonnees photo secondaire"),metadata:(o==null?void 0:o.secondaryPhoto)??null,thresholdKm:(o==null?void 0:o.submissionMatchThresholdKm)??1,unavailable:p,language:s}),e.jsxs("div",{className:"text-[10px] text-gray-400 uppercase tracking-widest font-bold",children:[r("IP Match Threshold","Seuil correspondance IP"),": ",(o==null?void 0:o.ipMatchThresholdKm)??50," km"]})]})]})]}),!l&&!c&&k.length===0&&e.jsx("div",{className:"bg-white border border-gray-100 rounded-2xl p-6 text-xs text-gray-500 text-center",children:r("No submissions found.","Aucune soumission trouvee.")}),!l&&!c&&k.length>0&&e.jsx("div",{className:"space-y-3",children:k.map(({item:i,state:a,siteName:d,preview:u})=>{const h=(n==null?void 0:n.event.id)===i.event.id;return e.jsx("button",{type:"button",onClick:()=>N(i),className:`w-full text-left bg-white border rounded-2xl overflow-hidden shadow-sm transition-colors ${h?"border-[#0f2b46]":"border-gray-100 hover:border-[#d5e1eb]"}`,children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"w-24 h-24 bg-gray-100 shrink-0 flex items-center justify-center",children:u?e.jsx("img",{src:u,alt:r("submission","soumission"),className:"h-full w-full object-cover"}):e.jsx(J,{size:18,className:"text-gray-300"})}),e.jsxs("div",{className:"flex-1 p-3 space-y-2",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-bold text-gray-900 leading-tight",children:d}),e.jsx("p",{className:"text-[10px] uppercase tracking-widest text-gray-400",children:F(i.event.category,s)})]}),e.jsx("span",{className:`text-[10px] font-bold uppercase tracking-widest px-2 py-1 rounded-lg border ${pe(a)}`,children:ue(a,s)})]}),e.jsxs("div",{className:"text-[11px] text-gray-600 flex items-center gap-1",children:[e.jsx(Q,{size:12}),e.jsx("span",{children:i.user.name}),e.jsx("span",{className:"text-gray-400",children:"•"}),e.jsx("span",{className:"truncate",children:i.user.email??i.user.id})]}),e.jsxs("div",{className:"text-[11px] text-gray-500 flex items-center gap-1",children:[e.jsx(W,{size:12}),e.jsx("span",{children:A(i.event.createdAt,p)})]})]})]})},i.event.id)})})]})]})};export{be as default};
